source, sed, xml/csv, ps

списки, циклы и условия.

# Лабораторная работа 2

Во второй лабораторной работе ты чуть глубже познакомишься с шелом Линукса. Ты уже умеешь пользоваться некоторыми командами и терминалом, но что если тебе нужно изо дня в день решать одну и ту же задачу и вводить постоянно вводить 5-10 разных комнад (например собирать исходный код приложения)? Звучит утомительно и неудобно, для того чтобы сделать нашу жизнь чуточку лучше в линуксе существует возможность выполнять bash-скрипты, про которые мы подробно по говорим в этой лабе.

## shebang

Каждый скрипт начинается со строки, указывающей каким интерпретатором пользоваться при его выполнении. В нашем случае она выглядит так:

```bash
#!/bin/bash
```

Таким образом мы говорим использовать bash.

Угадай, почему в python комментарии начинаются с `#`, и что будет, если написать в начале скрипта `#!/usr/bin/python`.

## А что мы пишем и зачем нужна `;`?

Bash скрипт выполяет команды bash построчно сверху вниз. В одной строке можно написать несколько команд, для этого используй разделитель `;`. Зачем писать несколько команд в одной строке? Я не знаю, зачем-то надо, раз есть возможность.

## Привет мир

Вот простейший скрипт, который выводит в консоль фразу привет мир

```bash
#!/bin/bash
HELLO_STR="hello world"
echo "$HELLO_STR"
```

Но у нас ведь есть только терминал, как нам писать скрипты, не cat же использовать, верно?

Верно, для редактирования файлов прямо из терминала можно использовать `vim`. Чтобы открыть файл для чтения введи команду `vim <ИМЯ_ФАЙЛА>`.

Курсор вима можно перемещать влево, вверх, вниз, вправо соответственно с помощью кнопок `h`, `j`, `k`, `l`. Чтобы начать ввод текста нажми `i` или `a`, это переведет `vim` в режим вставки симоволов и позволит тебе печатать. Чтобы сохранить изменения нажми `:`, в нижней части экрана можно вводить команды, команда `w` сохраняет файл. Теперь можешь выйти из `vim` и продолжить выполнение работы.

Для выполнения и демонстрации ЛР используйте `vim` или `nano`.

## Переменные

Мы уже объявили переменную в начале, она называлась `HELLO_STR`, чтобы объявить переменную напиши `ИМЯ_ПЕРЕМЕННОЙ=ЗНАЧЕНИЕ_ПЕРЕМЕННОЙ`.

## Условия

```bash
if условие
then
    команды
elif другое_условие
then
    команды
else
    команды
fi
```

Условия записываются в двойных квадратных скобках и могут объединяться конъюнкцией или дизъюнкцией (`&&`, `||`) 

```bash
[[ условие1 ]] && [[ условие2 ]]
```

Вот список доступных операторов для записи условий:  

Работают с числами:  

- `-eq` равно (`[[ 1 -eq 1 ]]`)
- `-ne` не равно (`[[1 -ne 2]]`)
- `-gt` больше (`[[ 2 -gt 1 ]]`)
- `-ge` больше или равно (`[[ 1 -ge 1 ]]`)
- `-lt` меньше (`[[ 1 -lt 2 ]]`)
- `-le` меньше или равно (`[[ 2 -le 2 ]]`)

Работают со строками:  

- `=` проверяет строки на равенство
- `!=` проверяет на неравенство
- `-z` проверяет на пустоту (`[[ -z "" ]]`)
- `-n` проверяет на непустоту (`[[ -n "not empty" ]]`)  

Работают с файлами:  

- `-e` существует ли файл/директория
- `-f` существует ли файл и является ли обычным файлом
- `-d` является ли директорией
- `-r` доступен ли файл на чтение
- `-w` доступен ли файл на запись
- `-x` доступен ли файл на исполнение

## Циклы

```bash
for var in список
do
    команды
done
```

В качестве списка можно использовать разные синтаксические конструкции:

```bash
for i in 1 2 3 4 5
do
    echo "i = $i"
done
```

```bash
for i in {1..5}
do
    echo $i
done
```

В переменной `file` будут содержатся имена файлов с расширением .txt из дирректории запуска скрипта

```bash
for file in *.txt
do
    echo "Текстовый файл: $file"
done
```

## Аргументы командной строки

Получить доступ к аргументам скрипта можно с помощью специальных переменных:  

- `$0` имя скрипта
- `$1` первый аргумент
- `$2` второй аргумент
- `$3` третий аргумент
- `$#` количество аргументов
- `$@` все аргументы списком (каждый — отдельное слово)
- `$*` все аргументы одной строкой
- `$$` PID текущего процесса
- `$?` код возврата предыдущей команды

## Перед тем как начать

Ты уже выполнил первую лабораторную работу, давай позаботимся о том, чтобы не потерять результаты нашей работы.

С помощью команды `git status` посмотри какие изменения были внесены в репозиторий

Теперь, если нет ничего лишнего, давай сохраним состояние репозитория, для этого перейди в корень и используй команды

```bash
git add .
git commit -m "commit name"
```

Только что мы создали commit, посмотреть историю коммитов можно с помощью команды `git log --online`

Теперь если что-то пойдет не так, ты всегда можешь откатиться к состоянию репозитория из любого коммита с помощью команды `git reset --hard <НОМЕР_КОММИТА>`. Номер коммита можно узнать внимательно прочитав вывод команды `git log --online` и `man git log`

## Задание 1 "Я сделаю свой jinja2 с bash-om и Линуксом"

1. Напишите bash скрипт, объявите в нем переменные LAB_NUM (равную номеру ЛР), ассоциативный массив SUBS, содержащий (ключ-значение): port-8080, host-localhost, secret-/etc/secret.txt
2. Запустите скрипт так, чтобы когда он завершит работу значения переменных остались доступны вам в терминале (`echo "$LAB_NUM"` выводит номер лабораторной работы).
3. Напишите скрипт, который печатает на экран LAB_NUM, и в каждом из файлов, переданных в качестве аргументов командной строки заменяет вхождения вида "`{КЛЮЧ из SUBS}`" на ЗНАЧЕНИЕ ИЗ SUBS.

## Задание 2. Маленький демон

1. Напишите bash скрипт, который сохраняет свой PID в файл `daemon.pid`
2. Дополните скрипт из п.1, он должен раз в 10 секунд запускать скрипт из задания 1 для всех файлов (или для каждого поочерёдно) в директории запуска скрипта выполнить скрипт из задания 1.
3. Напишите скрипт, который через 40-60 секунд остановит скрипт из п.2
4. Протестируйте п.2 и п.3, для этого запустите п.2 в фоновом режиме, затем запустите п.3

## Задание 3. Поточный редактор

Напишите bash скрипт, который принимает на ввод строку, выполняет в ней контекстную замену `{ИМЯ ИЗ SUBS}` на `ЗНАЧЕНИЕ ИЗ SUBS` и выводит её в стандартный вывод
